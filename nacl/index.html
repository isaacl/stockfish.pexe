<script>
function on_load() {
  console.log('load');

  window.Stockfish = document.getElementById('stockfish');
  window.Stockfish.postMessage('setoption name Threads value 5');
  window.Stockfish.postMessage('setoption name Hash value 512');
  window.Stockfish.postMessage('setoption name MultiPV value 3');
  window.Stockfish.postMessage('position fen R7/P5k1/7p/8/8/6PP/r7/4K3 w - - 0 1 moves');
  window.Stockfish.postMessage('go depth 99');
}

function on_message(e) {
  console.log(e.data);
}

function run_test() {
  var messages = [
    'setoption name Threads value 5',
    'setoption name Hash value 16',
    'setoption name MultiPV value 4',
    'position fen 8/8/1p3pk1/2b2RPp/4Pq1K/2Q3PP/p7/8 w - - 2 42 moves',
    'go depth 99'
  ];
  messages.forEach(function(msg) {
    console.log('> ' + msg);
    window.Stockfish.postMessage(msg);
  });
}
</script>

<div id="listener">
  <script>
    var listener = document.getElementById('listener');
    listener.addEventListener('load', on_load, true);
    listener.addEventListener('message', on_message, true);
  </script>

  <embed id="stockfish" width="0" height="0" src="stockfish.nmf" type="application/x-pnacl">
</div>
